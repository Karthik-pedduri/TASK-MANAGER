================================================================================
COMPREHENSIVE API ENDPOINT TESTS
================================================================================
[[94mINFO[0m] Setting up test user and authentication...
[[92mPASS[0m] Successfully authenticated
[[94mINFO[0m] Testing GET / (Root/Health Check)...
[[92mPASS[0m] Root endpoint healthy

========================================
TASK CREATION TESTS
========================================
[[94mINFO[0m] Testing POST /tasks/ with valid data...
[[92mPASS[0m] Created valid task (ID: 41)
[[94mINFO[0m] Testing POST /tasks/ with no stages...
[[92mPASS[0m] Created task without stages (ID: 42)
[[94mINFO[0m] Testing POST /tasks/ with missing name (should fail)...
[[92mPASS[0m] Correctly rejected task with missing name
[[94mINFO[0m] Testing POST /tasks/ with invalid priority (should fail)...
[[92mPASS[0m] Correctly rejected invalid priority 'urgent'
[[94mINFO[0m] Testing POST /tasks/ with invalid date format (should fail)...
[[92mPASS[0m] Correctly rejected invalid date format
[[94mINFO[0m] Testing POST /tasks/ with past due date...
[[92mPASS[0m] Created task with past due date (ID: 43) - API allows this
[[94mINFO[0m] Testing POST /tasks/ with very long name (150 chars, DB limit is 100)...
[[92mPASS[0m] DB constraint rejected long name (500) - consider adding Pydantic validation
[[94mINFO[0m] Testing POST /tasks/ with special characters in name...
[[92mPASS[0m] Created task with special chars (ID: 44)
[[94mINFO[0m] Testing POST /tasks/ with template_id...
[[92mPASS[0m] Template not found (expected if no templates exist)
[[94mINFO[0m] Testing POST /tasks/ with zero estimated_time_hours (should fail)...
[[91mFAIL[0m] Zero hours test: 201 - {'name': 'Invalid Stage Hours', 'description': None, 'due_date': '2026-03-03', 'priority': 'medium', 'template_id': None, 'assigned_user_id': None, 'idempotency_key': None, 'task_id': 46, 'status_state_id': 1, 'completed_date': None, 'created_at': '2026-02-24T09:10:38.563210Z', 'updated_at': None, 'assigned_user': None, 'stages': [{'stage_name': 'Bad Stage', 'estimated_time_hours': 0.0, 'order_number': 1, 'stage_id': 176, 'task_id': 46, 'status_state_id': 1, 'actual_time_hours': None, 'start_date': None, 'completed_date': None, 'created_at': '2026-02-24T09:10:38.563210Z', 'updated_at': None}]}
[[94mINFO[0m] Testing POST /tasks/ with negative estimated_time_hours (should fail)...
[[92mPASS[0m] Correctly rejected negative estimated hours

========================================
TASK RETRIEVAL TESTS
========================================
[[94mINFO[0m] Testing GET /tasks/41...
[[92mPASS[0m] Retrieved task 41 successfully
[[94mINFO[0m] Testing GET /tasks/999999 (should return 404)...
[[92mPASS[0m] Correctly returned 404 for non-existent task
[[94mINFO[0m] Testing GET /tasks/invalid (should fail)...
[[92mPASS[0m] Correctly rejected invalid task ID format
[[94mINFO[0m] Testing GET /tasks/-1 (should fail)...
[[92mPASS[0m] Correctly handled negative task ID
[[94mINFO[0m] Testing GET /tasks/...
[[92mPASS[0m] Listed 45 tasks successfully

========================================
TASK UPDATE TESTS
========================================
[[94mINFO[0m] Testing PATCH /tasks/41 with valid data...
[[92mPASS[0m] Updated task 41 successfully
[[94mINFO[0m] Testing PATCH /tasks/41 with single field...
[[92mPASS[0m] Partial update successful
[[94mINFO[0m] Testing PATCH /tasks/41 with empty payload...
[[92mPASS[0m] Empty payload correctly rejected (needs at least one field)
[[94mINFO[0m] Testing PATCH /tasks/41 with invalid priority...
[[92mPASS[0m] Correctly rejected invalid priority on update
[[94mINFO[0m] Testing PATCH /tasks/41 with past due date...
[[92mPASS[0m] Updated due date to past (may trigger overdue)
[[94mINFO[0m] Testing PATCH /tasks/999999 (should return 404)...
[[92mPASS[0m] Correctly returned 404 for non-existent task

========================================
STAGE UPDATE TESTS
========================================
[[94mINFO[0m] Testing PUT /tasks/stages/174 with valid data...
[[92mPASS[0m] Updated stage 174 successfully
[[94mINFO[0m] Testing PUT /tasks/stages/174 with negative hours...
[[92mPASS[0m] Correctly rejected negative actual hours
[[94mINFO[0m] Testing PUT /tasks/stages/174 with invalid status_state_id...
[[92mPASS[0m] Correctly rejected invalid status_state_id
[[94mINFO[0m] Testing PUT /tasks/stages/999999 (should return 404)...
[[92mPASS[0m] Correctly returned 404 for non-existent stage
[[94mINFO[0m] Testing PUT /tasks/stages with missing status_state_id...
[[92mPASS[0m] Correctly rejected missing status_state_id

========================================
STAGE DELETION TESTS
========================================
[[94mINFO[0m] Creating task with stages for deletion test...
[[94mINFO[0m] Testing DELETE /tasks/stages/178...
[[92mPASS[0m] Deleted stage, 2 stages remaining
[[94mINFO[0m] Testing DELETE /tasks/stages/999999 (should return 404)...
[[92mPASS[0m] Correctly returned 404 for non-existent stage

========================================
ANALYSIS ENDPOINT TESTS
========================================
[[94mINFO[0m] Testing GET /analysis/completion...
[[92mPASS[0m] Completion stats retrieved: ['total_completed', 'avg_duration_days', 'avg_delay_days', 'on_time_percentage', 'by_priority']
[[94mINFO[0m] Testing GET /analysis/overdue...
[[92mPASS[0m] Overdue stats: 8 overdue, 46 total
[[94mINFO[0m] Testing GET /analysis/stage-variance...
[[92mPASS[0m] Stage variance retrieved: ['total_completed_stages', 'avg_variance_hours', 'most_overestimated_stages', 'most_underestimated_stages', 'by_stage_name']
[[94mINFO[0m] Testing GET /analysis/visualizations/priority...
[[92mPASS[0m] Priority pie chart generated successfully
[[94mINFO[0m] Testing GET /analysis/visualizations/completion-trends...
[[92mPASS[0m] Completion trends chart generated
[[94mINFO[0m] Testing GET /analysis/visualizations/delay...
[[92mPASS[0m] Delay chart endpoint working
[[94mINFO[0m] Testing GET /analysis/reports/csv...
[[92mPASS[0m] CSV report generated with 182 lines

========================================
WORKFLOW TESTS
========================================
[[94mINFO[0m] 
=== WORKFLOW TEST: Complete Task Lifecycle ===
[[94mINFO[0m] Workflow: Created task 48
[[92mPASS[0m] Workflow: Task completed successfully after all stages completed
[[92mPASS[0m] Workflow: Analytics updated - 13 completed tasks
[[92mPASS[0m] Workflow: Test completed and cleaned up
[[94mINFO[0m] 
=== WORKFLOW TEST: Overdue Detection ===
[[92mPASS[0m] Overdue workflow: Overdue detection working

========================================
DELETION TESTS (Cleanup)
========================================
[[94mINFO[0m] Testing DELETE /tasks/999999 (should return 404)...
[[92mPASS[0m] Correctly returned 404 for non-existent task
[[94mINFO[0m] Testing DELETE /tasks/50...
[[91mFAIL[0m] Failed to delete task: 500 - {'detail': 'Internal Server Error', 'error': "name 'datetime' is not defined"}
[[94mINFO[0m] Testing DELETE /tasks/999999 (should return 404)...
[[92mPASS[0m] Correctly returned 404 for non-existent task

================================================================================
TEST SUMMARY
================================================================================
Total Tests: 45
[92mPassed: 43[0m
[91mFailed: 2[0m

Failed Tests:
  - Zero hours test: 201 - {'name': 'Invalid Stage Hours', 'description': None, 'due_date': '2026-03-03', 'priority': 'medium', 'template_id': None, 'assigned_user_id': None, 'idempotency_key': None, 'task_id': 46, 'status_state_id': 1, 'completed_date': None, 'created_at': '2026-02-24T09:10:38.563210Z', 'updated_at': None, 'assigned_user': None, 'stages': [{'stage_name': 'Bad Stage', 'estimated_time_hours': 0.0, 'order_number': 1, 'stage_id': 176, 'task_id': 46, 'status_state_id': 1, 'actual_time_hours': None, 'start_date': None, 'completed_date': None, 'created_at': '2026-02-24T09:10:38.563210Z', 'updated_at': None}]}
  - Failed to delete task: 500 - {'detail': 'Internal Server Error', 'error': "name 'datetime' is not defined"}
